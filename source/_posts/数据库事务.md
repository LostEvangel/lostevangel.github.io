---

title: 数据库事务总结
date: 2019-3-24 13:53:20
tags: [数据库,面试]
categories: 面试

---

# 数据库事务总结



---
## 事务

事务是一个不可分割的数据库操作序列，是数据库并发操作的基本单位，其结果是从一种一致性状态到另一种一致性状态。

### 四大特性（ACID）

#### 原子性（Atomicity）
事务是数据库逻辑工作单位，其操作要么全做，要么全不做。

#### 一致性（Consistency）
其结果必须是从一种一致性状态到另一种一致性状态。

#### 隔离性（Isolation）
一个事务的执行不能被其他事务干扰。

#### 持久性（Duration）
持久性表示一旦事务被提交了，数据库的数据改变就是永久性的，即使遇到故障也不会丢失提交的操作。

### 不考虑隔离性会出现的问题

- **脏读**： 一个事务读到了另一个未提交事务的数据。
- **不可重复读**：一个事务两次查询的间隔中，另一个事务修改并提交了数据，导致两次查询结果不同。
- **幻读**：一个事务两次查询中数据笔数不一致。

不可重复读和幻读都是查询中被另一个事务修改并提交了，不同的是不可重复读查询的是同一条数据，幻读是一批数据（比如数据的条数）。

### 隔离级别

- **Read Uncommitted(读未提交)**：所有事务都可以看到其他事务未提交的结果。一般很少用。
- **Read commited(读已提交)**：一个事务只能看见已提交的结果。除mysql外大多数数据库默认。
- **Repeatable Read(可重复读)**：确保了同一个事务的多个实例并发读数据时能看到相同的结果。mysql默认。
- **Serializable(顺序读)**：最高的隔离级别，解决了幻读，但会出现大量超时和锁竞争。

#### 事务隔离级别对比


事务隔离级别 | 脏读 | 不可重复读 | 幻读
---|:-:| :-:|:-:
Read Uncommitted | 允许 | 允许 | 允许
Read commited | 不允许 | 允许 | 允许
Repeatable Read | 不允许 | 不允许 | 允许
Serializable | 不允许 | 不允许 | 不允许

#### 隔离级别与锁
Read Uncommitted：读操作不加S锁。
Read commited：读操作加S锁，在语句执行完释放锁。
Repeatable Read：读操作加S锁，事务提交后释放锁。
Serializable：在Repeatable read的基础上，加范围锁。

### 操作
start transaction;开始事务

commit; 提交

rollback; 回滚


---

参考文献：https://www.weiweiblog.cn/databases/