---

title: 数据库索引总结
date: 2019-3-22 09:55:13
tags: [面试,数据库]
categories: [面试,数据库]

---

# 数据库索引总结



---

## 数据库索引
索引通常是由B树或者B+树实现。
### B树和B+树的区别
- B树的键和值也存在内部节点和叶子结点中，B+树内部结点只存键，叶子结点存键和值。
- B+树的叶子结点有一条链相连。

##### B树的好处
B树在内部存键值，频繁访问的节点在根节点附近可以提高查询效率，如果特定数据是重复读取，B树更好。
##### B+树的好处
一次读取大量数据时，因为B+树内部节点只存键，因此可以读取更多键，又因为叶子节点有链，读取大量数据时不需要每次都遍历内部节点。

### 数据库使用B+还不是B
**B树只适合随机检索，B+树同时适合随机检索和顺序检索。**

**B+树空间利用率更高，I/O次数少，磁盘读写少。**
索引也很大，需要以文件的形式存在磁盘中。索引查找就会产生I/O操作。B+树可以一次读取更多的关键字，因此I/O次数少。

**B+树查询效率更稳定。**
B树关键字在内部节点中也有，找到关键字就能确定记录。性能代价相当于二分查找。
B+树每次都是跟到叶节点，效率更稳定。

**B+树顺序遍历效率也不低。**
B+树叶子结点有链。

### 索引类型

- 主键索引：数据列不允许重复，不允许为null，一个表只能有一个主键索引。
- 唯一索引：数据列不允许重复，允许为null，一个表允许多个列创建唯一索引。
- 普通索引：没有唯一性限制，可以为空。
- 全文索引：主要用来查找文本中的关键字，而不是直接与索引中的值相比较。
- 联合索引：可以多个列共同创建联合索引。一个查询可以使用其中一个列，但必须遵守最左前缀原则。

### 聚集索与非聚集索
- 聚集索引：各行的物理顺序和逻辑顺序相同，一个表只能有一个。
- 非聚集索引：数据与索引在不同位置，索引中存在指向数据的指针，可以有多个。非聚集索引，分成普通索引，唯一索引，全文索引。

InnoDB的数据文件本身就是索引文件。InnoDB数据文件按聚集索引，所以InnoDB必须有主键。InnoDB聚集索引规则：
1. 如果有主键，主键就是聚集索引。
2. 如果没有主键，第一个唯一非空索引就是聚集索引。
3. 如果1、2都没有，会生成一个隐藏的主键作为聚集索引，它是6个字节的列，随着数据插入自增。

### MyISAM和InnoDB索引实现

索引 | MyISAM | InnoDB
---|---|---
主键索引  | 在主键索引中，索引页中存放的是主键和指向数据页的偏移量；数据页中存放的是主键和该主键所属行记录的地址空间。 | 在主键索引中，索引页中存放的是主键和指向数据页的偏移量；数据页中存放的是主键和该主键所属行记录的地址空间。
辅助索引  | 索引页仍然存放主键和和指向数据页的偏移量，但数据页存放的是完整的记录。  | 索引节点存放的内容一样，仍然是键值信息和指向数据页的偏移量；但数据页中存放的是键值信息和该键值对应的主键。然后通过主键查询主键索引就能找到该条记录。

### 索引的优点
- 创建唯一性索引，可以确保每行数据的唯一性。
- 提高数据检索效率。
- 加快表与表之间的连接。
- 使用分组和排序字句检索时，可以加快检索时间。
- 通过使用索引，在查询过程中，使用查询优化器，提高系统性能。

### 索引的缺点
- 时间方面：创建和维护需要时间。对数据增删改也需要对索引维护。
- 空间方面：索引需要占据物理空间。


### 索引的优化
- 非空字段：索引的列最好为非空。空值很难优化，用其他方式（0，特殊值等）代替空值。
- 取离散大的列：将更离散的数据放在联合索引前面。
- 索引字段越小越好：数据以页为单位存储，一页数据越多，一次IO操作得到的数据越多。
- 对 where,on,group by,order by 中出现的列使用索引。
- 对于like查询，%不放在前面。
- 最左前缀匹配原则。

### 最左前缀匹配原则
mysql会向右匹配到范围查询（<,>,between等），=、in放在左边。 = in 可以乱序。



